---
driver:
  name: vagrant
  customize:
    cpus: 2
    memory: 2048
  network:
    - - forwarded_port
      - guest: 8980
        host: 8980
        auto_correct: true

provisioner:
  name: chef_solo

platforms:
  - name: CentOS-6-x86_64-minimal
    driver_config:
      box: CentOS-6-x86_64-minimal
      box_url: http://mirror.informatik.hs-fulda.de/pub/vagrant/CentOS-6-x86_64-minimal.box
    attributes:
      postgresql:
        enable_pgdg_yum: "true"
      opennms:
        home: "/opt/opennms"
  - name: Ubuntu-1404-x86_64-server
    driver_config:
      box: Ubuntu-1404-x86_64-server
      box_url: http://mirror.informatik.hs-fulda.de/pub/vagrant/Ubuntu-1404-x86_64-server.box
    attributes:
      postgresql:
        enable_pgdg_apt: "true"
      opennms:
        home: "/usr/share/opennms"
suites:
  - name: default
    run_list:
      - recipe[java]
      - recipe[postgresql::server] 
      - recipe[snmp]
      - recipe[opennms::default]
    attributes:
      java:
        install_flavor: "openjdk"
        jdk_version: "7"
      postgresql:
        version: "9.3"
        password:
          postgres: "opennms_pg"
        pg_hba:
          - comment: "#local is for Unix domain socket connections only"
            type: "local"
            db: "all"
            user: "all"
            addr: ""
            method: "ident"
          - comment: "#IPv4 local connections:"
            type: "host"
            db: "all"
            user: "all"
            addr: "127.0.0.1/32"
            method: "md5"
          - comment: "#IPv6 local connections:"
            type: "host"
            db: "all"
            user: "all"
            addr: "::1/128"
            method: "md5"
      snmp:
        community: "notpublic"
        syscontact: "ronny@opennms.org"
        syslocationVirtual: "In the virtual kitchen"
        full_systemview: "true"
        disks:
          - mount: "/"
            min: "100000"
      opennms:
        release: "stable"
        jpda: "false"

  - name: remote-poller
    run_list:
      - recipe[java]
      - recipe[opennms::remote-poller]
    attributes:
      java:
        install_flavor: "openjdk"
        jdk_version: "7"
      snmp:
        community: "notpublic"
        syscontact: "ronny@opennms.org"
        syslocationVirtual: "In the virtual kitchen"
        full_systemview: "true"
        disks:
          - mount: "/"
            min: "100000"
      opennms:
        release: "stable"
